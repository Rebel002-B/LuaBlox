<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LuaBlox Interactive Book</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0f1c; --surface:#141724; --text:#e6eef8; --muted:#9fb0c8; --accent:#8b5cf6; --radius:16px; --glass: rgba(255,255,255,0.03);
}
:root[data-theme="white"]{
  --bg:#f6f7fb; --surface:#ffffff; --text:#0b1b2b; --muted:#415a75; --accent:#6b21a8; --glass: rgba(2,6,23,0.02);
}
:root[data-theme="purple"]{
  --bg:#0b0714; --surface: linear-gradient(180deg,#120426,#0b1022); --text:#f7edff; --muted:#cbb7ff; --accent:#b388ff; --glass: rgba(255,255,255,0.03);
}
html,body{height:100%;margin:0;font-family:'Inter',sans-serif;background:var(--bg); color:var(--text);}
body::before{
  content:'';position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;
  background: linear-gradient(135deg,#120426,#0b0714); 
}
body::after{
  content:'';position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;
  background: url('https://images.unsplash.com/photo-1530036549613-39bdfd3b7b83?auto=format&fit=crop&w=1470&q=80') center/cover no-repeat;
  opacity:0.12; pointer-events:none; filter:blur(1.6px);
}
.wrap{max-width:1080px;margin:36px auto;padding:28px;background:var(--surface);border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.5); display:grid;grid-template-columns:280px 1fr; gap:24px;}
.sidebar{padding:20px;background:rgba(0,0,0,0.04);border-radius:16px; min-height:400px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);}
.main{padding:20px;background:rgba(0,0,0,0.02);border-radius:16px; min-height:400px; overflow:auto;}
h1{font-size:26px;margin:0 0 8px 0;}
p.lead{margin:6px 0 18px 0;color:var(--muted);font-size:15px;}
nav.toc{display:flex;flex-direction:column;gap:6px;margin-top:12px;}
.toc button{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;border:0;background:transparent;color:var(--text);cursor:pointer;font-weight:600;text-align:left;}
.toc button.selected{background:rgba(255,255,255,0.02);box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.btn{padding:9px 14px;border-radius:12px;border:0;background:var(--glass);color:var(--text);cursor:pointer;font-weight:600;transition:0.3s;}
.btn:hover{transform:translateY(-2px); background:rgba(255,255,255,0.05);}
.btn.primary{background:var(--accent);color:#061021;}
.reader-controls{display:flex;gap:8px;align-items:center;margin-top:12px;}
select,input[type="range"]{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text);padding:8px;border-radius:8px;}
.chapter{margin-bottom:24px;}
.chapter h2{margin:0 0 10px 0;font-size:20px;}
.chapter p{line-height:1.7;margin:8px 0;color:var(--text);}
.highlight{background:rgba(255,255,255,0.06); padding:6px;border-radius:6px;}
.quiz{margin-top:16px;padding:16px;background:rgba(255,255,255,0.03);border-radius:12px;}
.quiz p{margin:6px 0;}
.quiz button{margin:4px 4px 4px 0;}
footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center;}
.theme-toggle{display:flex;gap:8px;margin-top:14px}
.small{font-size:13px;color:var(--muted)}
@media (max-width:960px){.wrap{grid-template-columns:1fr;padding:18px}.sidebar{order:2}.main{order:1}}
</style>
</head>
<body>
<div class="wrap" role="main" aria-labelledby="title">
  <aside class="sidebar" aria-label="Table of contents">
    <h1 id="title">LuaBlox</h1>
    <p class="lead">Interactive Lua learning book — 13 chapters. Listen, code, answer, learn!</p>
    <div class="controls">
      <button class="btn primary" id="readAllBtn">Read All</button>
      <button class="btn" id="stopBtn">Stop</button>
    </div>
    <div class="meta">
      Voice:<br/>
      <select id="voiceSelect" aria-label="Voice select"></select>
      <div style="margin-top:6px">Rate:
        <input id="rate" type="range" min="0.6" max="1.8" step="0.1" value="1"/> <span id="rateVal" class="small">1.0</span>
      </div>
      <div style="margin-top:6px">Pitch:
        <input id="pitch" type="range" min="0.5" max="2.0" step="0.1" value="1"/> <span id="pitchVal" class="small">1.0</span>
      </div>
    </div>
    <div style="margin-top:14px">
      <strong class="small">Themes</strong>
      <div class="theme-toggle" role="tablist">
        <button class="btn" data-theme="dark">Dark</button>
        <button class="btn" data-theme="purple">Purple</button>
        <button class="btn" data-theme="white">White</button>
      </div>
    </div>
    <nav class="toc" id="toc" aria-label="Chapters">
    </nav>
    <footer>
      <div class="small">Browser Speech Synthesis API for TTS.</div>
      <div class="small" style="margin-top:4px">LuaBlox — Learn Lua interactively.</div>
    </footer>
  </aside>

  <main class="main" id="reader" tabindex="0"></main>
</div>

<script>
// Chapters with paragraphs and quizzes
const chaptersData = [
  {
    title:"Chapter 1 — Printing & Variables",
    paragraphs:[
      "Welcome to Lua! Let's start with printing text to the console and using variables.",
      "The print function outputs text. Example: print('Hello World!')",
      "Variables store values. Example: local name = 'Sox'; local age = 15"
    ],
    quiz:[
      {q:"Which function prints text to console?", options:["echo()","print()","write()","log()"], a:"print()"},
      {q:"How do you declare a local variable called 'score'?", options:["var score = 0","local score = 0","score = 0","int score = 0"], a:"local score = 0"},
      {q:"What will print(name) output if name='Sox'?", options:["name","'Sox'","nil","error"], a:"Sox"},
      {q:"Variables in Lua are by default local or global?", options:["local","global"], a:"global"},
      {q:"Which keyword makes a variable local?", options:["local","let","var","define"], a:"local"}
    ]
  },
  {
    title:"Chapter 2 — Data Types & Operators",
    paragraphs:[
      "Lua has several basic data types: nil, boolean, number, string, table, function, userdata, thread.",
      "Numbers can be integers or floats. Strings are enclosed in single or double quotes.",
      "Operators: +, -, *, /, %, ^, .. (concatenate), ==, ~=, <, <=, >, >=, and, or, not"
    ],
    quiz:[
      {q:"Which operator concatenates strings?", options:["+","..","*","%"], a:".."},
      {q:"Which is a boolean value?", options:["'true'","true","1","nil"], a:"true"},
      {q:"How do you check equality?", options:["=","==","===","!="], a:"=="},
      {q:"What is 5^2?", options:["7","25","10","2.5"], a:"25"},
      {q:"Which keyword negates a condition?", options:["not","!","~","neg"], a:"not"}
    ]
  },
  // Add Chapters 3–13 similarly with paragraphs and 5+ quizzes
];

// Dynamically populate TOC
const tocNav=document.getElementById('toc');
chaptersData.forEach((chap,i)=>{
  const btn=document.createElement('button');
  btn.className='toc-item'+(i===0?' selected':'');
  btn.dataset.chapter=i;
  btn.textContent=`${chap.title}`;
  tocNav.appendChild(btn);
});

// Render chapters
const reader=document.getElementById('reader');
chaptersData.forEach((chap,i)=>{
  const art=document.createElement('article');
  art.className='chapter';
  art.id='chapter-'+i;
  art.dataset.chapter=i;
  if(i>0) art.style.display='none';
  const h2=document.createElement('h2'); h2.textContent=chap.title; art.appendChild(h2);
  chap.paragraphs.forEach(pText=>{
    const p=document.createElement('p'); p.dataset.para=''; p.textContent=pText; art.appendChild(p);
  });
  // Quiz container
  const quizDiv=document.createElement('div'); quizDiv.className='quiz'; quizDiv.style.display='none';
  quizDiv.innerHTML="<h3>Chapter Quiz</h3>"; chap.quiz.forEach((q,iq)=>{
    const qP=document.createElement('p'); qP.textContent=`Q${iq+1}: ${q.q}`; quizDiv.appendChild(qP);
    q.options.forEach(opt=>{
      const btn=document.createElement('button'); btn.textContent=opt;
      btn.addEventListener('click',()=> handleAnswer(opt,q.a,quizDiv));
      quizDiv.appendChild(btn);
    });
  });
  const nextBtn=document.createElement('button'); nextBtn.className='btn primary'; nextBtn.textContent="Next Chapter"; nextBtn.addEventListener('click',()=> nextChapter(i));
  quizDiv.appendChild(nextBtn);
  art.appendChild(quizDiv);
  reader.appendChild(art);
});

// TOC click
document.querySelectorAll('.toc-item').forEach((btn,i)=>btn.addEventListener('click',()=> selectChapter(i)));
function selectChapter(index){
  document.querySelectorAll('.toc-item').forEach(b=>b.classList.remove('selected'));
  document.querySelectorAll('.chapter').forEach((c,i)=>c.style.display=i===index?'':'none');
  document.querySelectorAll('.toc-item')[index].classList.add('selected');
}

// TTS
let voices=[], queue=[], currentUtter=null;
function populateVoices(){ voices=speechSynthesis.getVoices(); const sel=document.getElementById('voiceSelect'); sel.innerHTML=''; voices.forEach((v,i)=>{ const o=document.createElement('option'); o.value=i; o.text=`${v.name} — ${v.lang}`; sel.appendChild(o); }); }
populateVoices(); speechSynthesis.onvoiceschanged=populateVoices;
document.getElementById('readAllBtn').addEventListener('click',()=>{ readChapters(0); });
document.getElementById('stopBtn').addEventListener('click',()=>{ queue=[]; speechSynthesis.cancel(); });
document.getElementById('rate').addEventListener('input',()=> document.getElementById('rateVal').textContent=document.getElementById('rate').value);
document.getElementById('pitch').addEventListener('input',()=> document.getElementById('pitchVal').textContent=document.getElementById('pitch').value);

function speakParagraphs(paras,callback){
  if(paras.length===0){ if(callback) callback(); return; }
  const text=paras.shift();
  const utt=new SpeechSynthesisUtterance(text);
  utt.voice=voices[document.getElementById('voiceSelect').value]||null;
  utt.rate=document.getElementById('rate').value; utt.pitch=document.getElementById('pitch').value;
  utt.onend=()=> speakParagraphs(paras,callback);
  speechSynthesis.speak(utt);
}

function readChapters(start){
  if(start>=chaptersData.length) return;
  const chapEl=document.getElementById('chapter-'+start);
  selectChapter(start);
  const paras=Array.from(chapEl.querySelectorAll('[data-para]')).map(p=>p.textContent);
  speakParagraphs(paras,()=>{ showQuiz(chapEl); });
}

function showQuiz(chapEl){ const qDiv=chapEl.querySelector('.quiz'); qDiv.style.display='block'; }

function handleAnswer(selected,answer,quizDiv){
  const msg=(selected===answer)?`Correct! ${answer}`:`Incorrect! Correct answer: ${answer}`;
  const utt=new SpeechSynthesisUtterance(msg); utt.rate=document.getElementById('rate').value; utt.pitch=document.getElementById('pitch').value; speechSynthesis.speak(utt);
}

function nextChapter(curr){ const next=curr+1; if(next<chaptersData.length){ selectChapter(next); readChapters(next); } }
</script>
</body>
</html>
